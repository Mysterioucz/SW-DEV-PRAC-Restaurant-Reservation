@startuml
title Auth Flow: POST /api/register

participant "Client" as Client
participant "<<Node.js>>\nserver" as Server
participant "<<router>>\nregister" as Router
participant "<<controller>>\nregister" as Controller
participant "<<model>>\nUser" as Model
database "<<Database>>\nPostgreSQL" as DB

Client -> Server: POST /api/register
Server -> Router: router.post('/register', register)
Router -> Controller: register(req, res)
Controller -> Controller: extract name, email, telephone, password

alt [missing required fields]
    Controller --> Client: 400 Bad Request { error:"Missing required fields" }
    note right: [continue]
end

Controller -> Model: User.findUnique({ email })
Model -> DB: SELECT * FROM User WHERE email = ?
DB --> Model: user or null
Model --> Controller: existingUser or null

alt [email already registered]
    Controller --> Client: 400 Bad Request { error:"Email already registered" }
    note right: [continue]
end

Controller -> Controller: bcrypt.hash(password, 10)
note right of Controller: hash password with salt rounds
Controller --> Controller: hashedPassword

Controller -> Model: User.create({ name, email, telephone, hashedPassword })
Model -> DB: INSERT INTO User VALUES (...)
DB --> Model: user record
Model --> Controller: user { id, name, email, telephone, role }

Controller --> Client: 201 Created { message:"User registered successfully", user }

@enduml
